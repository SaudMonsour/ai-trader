# Logrotate configuration for Trading Agent
# Place this file at: /etc/logrotate.d/trading-agent
# Or reference it with: logrotate -f /path/to/this/file

/opt/trading-agent/logs/trading.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress old logs (gzip)
    compress
    delaycompress
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate if empty
    notifempty
    
    # Create new log with these permissions
    create 0644 ubuntu ubuntu
    
    # Rotate even if multiple processes have file open
    sharedscripts
    
    # After rotation, send SIGHUP to reload (optional)
    postrotate
        # If using systemd, uncomment:
        # systemctl reload trading-agent.service > /dev/null 2>&1 || true
        
        # Or if using supervisord:
        # supervisorctl restart trading-agent > /dev/null 2>&1 || true
    endscript
    
    # Maximum size before rotation (regardless of time)
    size 100M
}

/opt/trading-agent/logs/health.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 ubuntu ubuntu
    sharedscripts
    size 50M
}

# For testing:
# sudo logrotate -d /etc/logrotate.d/trading-agent
# 
# Force rotation now:
# sudo logrotate -f /etc/logrotate.d/trading-agent
